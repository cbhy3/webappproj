{% extends 'base.html' %}
{% block content %}

  <style>

        .game-container {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
  .balls {
    display: none; /* Hidden by default */
    position: fixed;
    z-index: 1000; /* On top of other elements */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.4); /* Black with opacity */
}

.balls-content {
    background-color: #fff;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    border-radius: 8px;
    width: 40%;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.claim-button {
    background-color: #4CAF50; /* Green */
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    margin-top: 20px;
    display: inline-block;
}

.claim-button:hover {
    background-color: #45a049;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}
        .game-container .info-icon {
            position: relative;
            display: inline-block;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .game-container .info-icon svg {
            width: 24px;
            height: 24px;
            fill: #555;
        }
        .game-container .info-tooltip {
            visibility: hidden;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 4px;
            padding: 5px 10px;
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1;
            white-space: nowrap;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .game-container .info-icon:hover .info-tooltip {
            visibility: visible;
            opacity: 1;
        }
        .game-container .grid {
            display: grid;
            grid-template-columns: repeat(7, 100px);
            grid-gap: 10px;
        }
        .game-container .card-container {
            perspective: 1000px; /* Enable 3D space */
        }
        .game-container .card{
            width: 100px;
            height: 150px;
            background-color: #e2bc74;
            border: 2px solid #855121;
            color: white;
            font-size: 18px;
            text-align: center;
            line-height: 150px;
            cursor: pointer;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
            transform-style: preserve-3d;
        }
        .game-container .card img {
            max-width: 80%;
            max-height: 80%;
            object-fit: contain;
            visibility:hidden;
        }

        .game-container .card:hover {
            transform: scale(1.05);
        }
    </style>
    <script>
        var tries = 15;
        const itemDistribution = {
            "Apple": [0.1364, 0, "10% discount on next purchase"],
            "Banana": [0.1005, 0, "15% discount on next purchase"],
            "Grape": [0.1839, 0, "Complimentary chocolate bar with next purchase (subject to availability, if no chocolate bar is available, a substitute will be sent)"],
            "Orange": [0.1660,0, "5% discount on next purchase"],
            "Watermelon":[0.1839,0, "Complimentary environmentally friendly tote bag with next purchase"],
            "Pineapple":[0.1660,0, "Free shipping on next purchase" ],
            "Mango":[0.0633,0, "50% discount on next purchase"]
        };
        const cards = {
            1 : "Unflipped",
            2 : "Unflipped",
            3 : "Unflipped",
            4 : "Unflipped",
            5 : "Unflipped",
            6 : "Unflipped",
            7 : "Unflipped",
            8 : "Unflipped",
            9 : "Unflipped",
            10 : "Unflipped",
            11 : "Unflipped",
            12 : "Unflipped",
            13 : "Unflipped",
            14 : "Unflipped",
            15 : "Unflipped",
            16 : "Unflipped",
            17 : "Unflipped",
            18 : "Unflipped",
            19 : "Unflipped",
            20 : "Unflipped",
            21 : "Unflipped",
        }
        var cardsList = {...cards}
        var items = {...itemDistribution}
        function reveal(id){
            var card = document.getElementById(id)
            var img = card.getElementsByTagName("img")
            if (cardsList[id] == "Unflipped"){
                if (tries > 0){
                    cardsList[id] = "Flipped"
                    var roll = Math.random();
                    let cumulative = 0;
                    tries--;
                    for (var item in items){
                        cumulative += items[item][0];
                        if (roll <= cumulative){
                            var chosen = item;
                            items[chosen][1]++;

                            break;
                        }
                    }


                card.style.backgroundColor = "#FFFFFF"
                img[0].style.visibility = "visible"
                img[0].src = `/static/${chosen}.jpg`
                if (items[chosen][1] == 3){
                    tries = 0;
                    showModal(`Congratulations! You won ${items[chosen][2]}!`);
                }
                }
        }
    };
        function showModal(message) {
    const modal = document.getElementById("winModal");
    const winMessage = document.getElementById("winMessage");
    winMessage.textContent = message;
    modal.style.display = "block";
}

function closeModal() {
    const modal = document.getElementById("winModal");
    modal.style.display = "none";
}
    </script>


<body>
<div class="game-container">
    <div id="winModal" class="modal balls">
    <div class="modal-content balls-content">
        <p id="winMessage"></p>
                <button class="claim-button" onclick="closeModal()">Claim Prize</button>

    </div>
</div>
    <div class="info-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2zm0 18a8 8 0 1 1 8-8 8 8 0 0 1-8 8zm-.9-13h1.8v2h-1.8zm0 4h1.8v7h-1.8z" />
        </svg>
        <div class="info-tooltip">Click on cards to reveal items. You have 10 tries. If you reveal the same item 3 times, you win a prize!
           <p> Prizes:</p>
            <ul>
                <li>3 Watermelons: Complimentary environmentally friendly tote bag with next purchase</li>
                <li>3 Grapes: Complimentary chocolate bar with next purchase (subject to availability, if no chocolate bar is available, a substitute will be sent)</li>
                <li>3 Oranges: 5% discount on next purchase</li>
                <li>3 Pineapples: Free shipping on next purchase</li>
                <li>3 Apples: 10% discount on next purchase</li>
                <li>3 Bananas: 15% discount on next purchase</li>
                <li>3 Mangoes: 50% discount on next purchase</li>
            </ul>
        </div>
    </div>
    <div class="grid">
        <div class="card" id = "1" onclick="reveal(1)"><img src ='#'></div>
        <div class="card" id = "2" onclick="reveal(2)"><img src ='#'></div>
        <div class="card" id = "3" onclick="reveal(3)"><img src ='#'></div>
        <div class="card" id = "4" onclick="reveal(4)"><img src ='#'></div>
        <div class="card" id = "5" onclick="reveal(5)"><img src ='#'></div>
        <div class="card" id = "6" onclick="reveal(6)"><img src ='#'></div>
        <div class="card" id = "7" onclick="reveal(7)"><img src ='#'></div>
        <div class="card" id = "8" onclick="reveal(8)"><img src ='#'></div>
        <div class="card" id = "9" onclick="reveal(9)"><img src ='#'></div>
        <div class="card" id = "10"onclick="reveal(10)"><img src ='#'></div>
        <div class="card" id = "11"onclick="reveal(11)"><img src ='#'></div>
        <div class="card" id = "12"onclick="reveal(12)"><img src ='#'></div>
        <div class="card" id = "13"onclick="reveal(13)"><img src ='#'></div>
        <div class="card" id = "14"onclick="reveal(14)"><img src ='#'></div>
        <div class="card" id = "15"onclick="reveal(15)"><img src ='#'></div>
        <div class="card" id = "16"onclick="reveal(16)"><img src ='#'></div>
        <div class="card" id = "17"onclick="reveal(17)"><img src ='#'></div>
        <div class="card" id = "18"onclick="reveal(18)"><img src ='#'></div>
        <div class="card" id = "19"onclick="reveal(19)"><img src ='#'></div>
        <div class="card" id = "20"onclick="reveal(20)"><img src ='#'></div>
        <div class="card" id = "21"onclick="reveal(21)"><img src ='#'></div>
    </div>
</div>
</body>
{% endblock %}
</html>


<!-- 
How the game works:
What item a card has is only determined when the card is revealed, i.e no playing the system and winning the best prize everytime
The odds of winning a certain prize are determined by how good the prize is.

Odds as well as the prizes are as follows:

Grape = Complimentary chocolate bar with next purchase (subject to availability, if no chocolate bar is available, a substitute will be sent) (24.5%)
Watermelon = Complimentary environmentally friendly tote bag with next purchase (24.5%)
Pineapple = Free shipping on next purchase (18%)
Orange = 5% discount on next purchase (18%)
Apple = 10% discount on next purchase (10%)
Banana = 15% discount on next purchase (4%)
Mango = 50% discount on next purchase (1%)

Keep in mind these above odds are only for pulling 3, odds for each individual card are as follows:

Grape: 18.39%
Watermelon: 18.39%
Pineapple: 16.60%
Orange: 16.60%
Apple: 13.64%
Banana: 10.05%
Mango: 6.33%

Gacha card flip before GTA 6 is crazy

